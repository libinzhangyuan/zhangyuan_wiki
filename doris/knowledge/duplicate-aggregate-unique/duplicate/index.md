[返回](/doris/knowledge/duplicate-aggregate-unique/index)


# Doris数据库中的Duplicate（明细模型）介绍

Duplicate模型是Apache Doris中三种数据模型之一，它适合存储原始的明细数据，不会对数据进行任何聚合。

## 特点

1. **保留原始数据**：不进行任何聚合，完全保留导入的原始数据
2. **适合场景**：需要存储完整明细数据的业务，如日志数据、交易记录等
3. **无主键约束**：允许重复数据存在，没有唯一性约束
4. **全明细查询**：可以查询到最细粒度的原始数据

## 创建Duplicate模型表示例

```sql
CREATE TABLE IF NOT EXISTS example_db.log_data
(
    `ts` DATETIME NOT NULL COMMENT "日志时间",
    `device_id` VARCHAR(50) COMMENT "设备ID",
    `user_id` BIGINT COMMENT "用户ID",
    `action` VARCHAR(20) COMMENT "用户行为",
    `ip` VARCHAR(20) COMMENT "IP地址",
    `province` VARCHAR(20) COMMENT "省份",
    `city` VARCHAR(20) COMMENT "城市"
)
DUPLICATE KEY(ts, device_id)
DISTRIBUTED BY HASH(device_id) BUCKETS 10
PROPERTIES (
    "replication_num" = "3"
);
```

## 数据插入示例

```sql
INSERT INTO example_db.log_data VALUES
('2023-01-01 08:00:01', 'device001', 1001, 'login', '192.168.1.1', '北京', '北京'),
('2023-01-01 08:00:02', 'device002', 1002, 'login', '192.168.1.2', '上海', '上海'),
('2023-01-01 08:00:03', 'device001', 1001, 'click', '192.168.1.1', '北京', '北京'),
('2023-01-01 08:00:04', 'device003', 1003, 'login', '192.168.1.3', '广东', '深圳'),
('2023-01-01 08:00:05', 'device001', 1001, 'logout', '192.168.1.1', '北京', '北京');
```

## 查询结果示例

查询所有日志数据：

```sql
SELECT * FROM example_db.log_data ORDER BY ts;
```

返回结果：

```
| ts                  | device_id | user_id | action | ip          | province | city   |
|---------------------|-----------|---------|--------|-------------|----------|--------|
| 2023-01-01 08:00:01 | device001 | 1001    | login  | 192.168.1.1 | 北京     | 北京   |
| 2023-01-01 08:00:02 | device002 | 1002    | login  | 192.168.1.2 | 上海     | 上海   |
| 2023-01-01 08:00:03 | device001 | 1001    | click  | 192.168.1.1 | 北京     | 北京   |
| 2023-01-01 08:00:04 | device003 | 1003    | login  | 192.168.1.3 | 广东     | 深圳   |
| 2023-01-01 08:00:05 | device001 | 1001    | logout | 192.168.1.1 | 北京     | 北京   |
```

## 明细模型与其他模型对比

```
| 特性            | Duplicate模型       | Aggregate模型      | Unique模型        |
|----------------|---------------------|-------------------|------------------|
| 数据保留        | 完整原始数据          | 聚合后的数据        | 最新版本数据       |
| 是否去重        | 不去重               | 按聚合键去重        | 按主键去重         |
| 存储空间        | 较大                 | 较小               | 中等              |
| 适用场景        | 日志、交易记录等明细数据 | 报表、统计类数据     | 需要唯一约束的数据  |
| 查询性能        | 明细查询快            | 聚合查询快          | 点查询快           |
```

## 典型使用场景

1. **用户行为分析**：存储用户点击流、浏览记录等原始数据
2. **日志分析**：存储系统日志、应用日志等
3. **交易记录**：存储完整的交易流水数据
4. **事件追踪**：存储用户操作事件序列

## 注意事项

1. 明细模型会占用更多存储空间，因为不进行任何聚合
2. 对于需要频繁进行SUM、COUNT等聚合操作的场景，可能性能不如Aggregate模型
3. 没有主键约束，完全相同的行会被全部保留
4. 适合配合Rollup表使用，在明细数据基础上建立聚合视图