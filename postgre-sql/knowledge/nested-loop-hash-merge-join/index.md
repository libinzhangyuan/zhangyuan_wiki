[返回](/postgre-sql/knowledge/index)
# PostgreSQL 连接方式介绍

在 PostgreSQL 中，有三种主要的表连接(Join)算法，每种算法适用于不同的场景：

## 1. 嵌套循环连接 (Nested Loop Join)

**工作原理**：
- 对外表的每一行，遍历内表的所有行进行匹配
- 类似于编程中的双重循环结构

**适用场景**：
- 当其中一个表非常小（通常作为外表）时效率高
- 内表有适合的索引可用时性能较好
- 不需要对表进行排序

**优缺点**：
- 优点：实现简单，对小表非常高效
- 缺点：当表较大时性能急剧下降，时间复杂度O(M*N)

## 2. 哈希连接 (Hash Join)

**工作原理**：
1. 首先对较小的表构建哈希表（内存中）
2. 然后扫描较大的表，对每行计算哈希值并在哈希表中查找匹配项

**适用场景**：
- 当两个表都较大且没有合适的索引时
- 等值连接（=）的情况
- 内存足够容纳较小表的哈希表时

**优缺点**：
- 优点：对大表连接效率高，时间复杂度接近O(M+N)
- 缺点：需要足够内存，仅适用于等值连接

## 3. 归并连接 (Merge Join)

**工作原理**：
1. 首先对两个表按连接键进行排序
2. 然后像合并两个有序数组一样扫描两个表，找出匹配行

**适用场景**：
- 当两个表都已按连接键排序或已有合适的索引时
- 适用于等值连接和非等值连接(>, <, >=, <=等)
- 特别适合大型数据集的连接

**优缺点**：
- 优点：对大型有序数据集非常高效
- 缺点：如果数据未排序，需要额外排序开销

PostgreSQL 的查询优化器会根据表大小、索引情况、内存设置等因素自动选择最合适的连接算法。