# Uniapp 各运行环境本地存储差异对比

Uniapp 提供了多种本地存储方案，但在不同运行环境下表现有所差异。以下是主要运行环境的本地存储特性对比：

## 1. 通用存储方案：uni.setStorage/uni.getStorage

### 共同点
- 所有平台都支持的 API
- 异步操作，推荐使用
- 存储大小限制一般为 5-10MB

### 各平台差异
```
| 运行环境       | 实现方式                          | 持久性                     | 特殊限制                     |
|----------------|-----------------------------------|----------------------------|----------------------------|
| H5             | localStorage                      | 浏览器关闭后保留           | 同源策略限制               |
| 微信小程序     | wx.setStorage                     | 清除缓存后失效             | 主包分包存储共享           |
| 支付宝小程序   | my.setStorage                     | 清除缓存后失效             | 无特殊限制                 |
| 百度小程序     | swan.setStorage                   | 清除缓存后失效             | 无特殊限制                 |
| 字节跳动小程序 | tt.setStorage                     | 清除缓存后失效             | 无特殊限制                 |
| QQ小程序       | qq.setStorage                     | 清除缓存后失效             | 无特殊限制                 |
| App(Android/iOS)| SharedPreferences(Android)/NSUserDefaults(iOS) | 应用卸载前保留 | 无特殊限制 |
| 快应用         | storage.set                       | 清除缓存后失效             | 无特殊限制                 |
```
## 2. 同步存储方案：uni.setStorageSync/uni.getStorageSync

### 差异点
- H5、小程序和App都支持
- 快应用不支持同步API
- 性能考虑，不推荐大量使用

## 3. 存储上限差异
```
| 环境         | 一般限制       | 备注                      |
|--------------|--------------|--------------------------|
| H5           | 5MB          | 不同浏览器可能不同        |
| 微信小程序   | 10MB         | 单个小程序总上限          |
| 支付宝小程序 | 10MB         |                          |
| 百度小程序   | 10MB         |                          |
| App          | 理论上无限制  | 但建议合理使用            |
```
## 4. 特殊存储方案

### 4.1 SQLite (仅App支持)
- 通过plus.sqlite操作
- 适合大量结构化数据存储
- 持久性高，应用卸载才清除

### 4.2 文件存储 (所有平台)
- 通过uni.saveFile/uni.getFileInfo等API
- App端功能最完整
- 小程序有各自限制

### 4.3 全局变量
- `globalData` 在页面关闭后不持久
- 小程序和App支持，H5也可用但刷新丢失

## 5. 注意事项

1. **H5端**：localStorage有同源策略限制，不同子域名不共享
2. **小程序端**：清除缓存会删除所有存储数据
3. **App端**：数据持久性最好，但要注意敏感数据加密
4. **数据加密**：敏感数据建议自行加密后再存储
5. **兼容性**：复杂对象存储前应先JSON序列化

## 最佳实践建议

1. 优先使用异步API(uni.setStorage)
2. 重要数据应考虑跨平台兼容性处理
3. 大量数据考虑使用App端的SQLite
4. 定期清理过期数据，避免达到存储上限
5. 对存储失败的情况做好错误处理

通过了解这些差异，可以更好地编写跨平台的本地存储代码，确保应用在各环境下表现一致。